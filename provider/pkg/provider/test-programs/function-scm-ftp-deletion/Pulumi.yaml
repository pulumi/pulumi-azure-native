name: function-scm-ftp-deletion
runtime: yaml
description: Set up function with scm and ftp access denied
variables:
  storageAccountKeys:
   Fn::Invoke:
     function: azure-native:storage:listStorageAccountKeys
     arguments:
       resourceGroupName: ${rg.name}
       accountName: ${sta.name}

resources:
  rg:
    type: azure-native:resources:ResourceGroup
  sta:
    type: azure-native:storage:StorageAccount
    properties:
      resourceGroupName: ${rg.name}
      kind: StorageV2
      sku:
        name: Standard_LRS
  plan:
    type: azure-native:web:AppServicePlan
    properties:
      resourceGroupName: ${rg.name}
      sku:
        name: B1
        tier: Basic
  app:
    type: azure-native:web:WebApp
    properties:
      resourceGroupName: ${rg.name}
      httpsOnly: true
      serverFarmId: ${plan.id}
      clientAffinityEnabled: true
      siteConfig:
        appSettings:
          - name: AzureWebJobsStorage
            value: DefaultEndpointsProtocol=https;AccountName=${sta.name};AccountKey=${storageAccountKeys.keys[0].value}
          - name: FUNCTIONS_EXTENSION_VERSION
            value: "~3"
          - name: FUNCTIONS_WORKER_RUNTIME
            value: dotnet
          - name: WEBSITE_CONTENTAZUREFILECONNECTIONSTRING
            value: DefaultEndpointsProtocol=https;AccountName=${sta.name};AccountKey=${storageAccountKeys.keys[0].value}
          - name: WEBSITE_CONTENTSHARE
            value: devpod
  scmAllowed:
    type: azure-native:web:WebAppScmAllowed
    properties:
      resourceGroupName: ${rg.name}
      name: ${app.name}
      allow: false
  ftpAllowed:
    type: azure-native:web:WebAppFtpAllowed
    properties:
      resourceGroupName: ${rg.name}
      name: ${app.name}
      allow: false
